<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>MovieChain (Demo)</title>
  <meta name="description" content="–î–µ–º–æ: –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–∏–Ω–æ—Ü–µ–ø–æ—á–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ —ç–º–æ—Ü–∏–π –∏ –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤. –ë–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö –∫–ª—é—á–µ–π."/>
  <style>
    /* –°—Ç–∏–ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –ø–æ—á—Ç–∏ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π (—É—Ä–µ–∑–∞–Ω—ã —Ç–æ–ª—å–∫–æ –Ω–µ–Ω—É–∂–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏) */
body:not(.dark-theme) #favoritesBtn.active .favorites-icon { fill: #ff3b30; stroke: #ff3b30; }
body.dark-theme #favoritesBtn.active .favorites-icon { fill: none; stroke: #ff3b30; }
#favoritesBtn .favorites-icon { fill: none; stroke: currentColor; transition: fill 0.2s, stroke 0.2s; }

@font-face { font-family: 'SF Pro Display'; src: local('.SFNSDisplay-Bold'); font-weight:700; }
@font-face { font-family: 'SF Pro Text'; src: local('.SFNSText-Regular'); font-weight:400; }
body { font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; margin:0; background: linear-gradient(135deg,#f8fafc 0%,#eef4ff 100%); color:#1d1d1f; }
.dark-theme { background: linear-gradient(135deg,#0f0f12 0%,#15151b 100%); color:#f5f5f5; }

/* Header */
.fixed-header { position: fixed; top:0; left:0; right:0; z-index:100; padding:16px 20px; display:flex; justify-content:space-between; align-items:center; background: rgba(255,255,255,0.65); backdrop-filter: blur(30px); border-bottom:1px solid rgba(210,210,215,0.4); box-shadow:0 4px 20px rgba(0,0,0,0.03); }
.dark-theme .fixed-header { background: rgba(20,20,22,0.7); border-bottom-color: rgba(60,60,65,0.5); box-shadow:0 4px 20px rgba(0,0,0,0.2); }

.logo { font-size: 24px; font-weight:700; background: linear-gradient(90deg,#0071e3,#ff2d55); -webkit-background-clip:text; background-clip:text; color:transparent; }

.header-button { display:flex; align-items:center; gap:8px; padding:10px 18px; border-radius:14px; background: rgba(255,255,255,0.4); border:1px solid rgba(210,210,215,0.6); color:#1d1d1f; font-family:'SF Pro Text'; font-weight:600; font-size:16px; cursor:pointer; transition: border-color .2s; }
.dark-theme .header-button { background: rgba(40,40,42,0.6); border-color: rgba(60,60,65,0.7); color:#f5f5f5; }

#favoritesBtn svg { color: inherit; transition: color .2s ease; }
#favoritesBtn.active svg { color: #ff3b30; }

.theme-toggle-apple { width:76px; height:36px; background:rgba(255,255,255,0.3); backdrop-filter: blur(20px); border-radius:18px; border:1px solid rgba(210,210,215,0.5); display:flex; align-items:center; padding:0 4px; cursor:pointer; overflow:hidden; }
.dark-theme .theme-toggle-apple { background: rgba(30,30,32,0.4); border-color: rgba(60,60,65,0.6); }

.knob-apple { width:32px; height:32px; background:white; border-radius:16px; box-shadow:0 2px 5px rgba(0,0,0,0.2); transition: transform .3s; }
.dark-theme .knob-apple { background:#2c2c2e; box-shadow:0 2px 5px rgba(0,0,0,0.4); }
.icon-center { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); font-size:16px; pointer-events:none; }

.main-content { max-width:1000px; margin:120px auto 40px; padding:0 20px; }

.search-card { background:white; border:1px solid #d2d2d7; border-radius:30px; box-shadow:0 8px 30px rgba(0,0,0,0.08); padding:42px; overflow:visible; }
.dark-theme .search-card { background:#1c1c1e; border-color:#3a3a3c; box-shadow:0 8px 30px rgba(0,0,0,0.3); }

.intro-text { margin:0; text-align:center; font-size:18px; line-height:1.5; color:#1d1d1f; font-family:'SF Pro Display'; }
.dark-theme .intro-text { color:#f5f5f5; }

.input-group { display:grid; grid-template-columns: minmax(110px,150px) 1fr minmax(110px,150px); gap:16px; margin-bottom:32px; align-items:center; }
@media (max-width:600px) { .input-group { grid-template-columns:1fr; gap:12px; } .action-button { padding:14px; font-size:15px; } }

.action-button { display:flex; align-items:center; justify-content:center; gap:8px; padding:16px; min-height:48px; border-radius:14px; font-family:'SF Pro Text'; font-weight:600; font-size:15px; cursor:pointer; transition: all .2s; border:1px solid transparent; }
#settingsBtn { background:white; border:1px solid #d8d8dd; color:#1d1d1f; }
.dark-theme #settingsBtn { background:#1c1c1e; border-color:#3a3a3c; color:#f5f5f5; }
#settingsBtn:hover { transform:scale(1.05); border:2px solid #0071e3; }

#searchBtn { background:#0071e3; border:1px solid #0071e3; color:white; }
#searchBtn:hover:not(:disabled) { box-shadow:0 0 12px rgba(0,113,227,0.4); transform:scale(1.02); }
#searchBtn:disabled { opacity:0.5; cursor:not-allowed; }

#movieInput { width:100%; padding:14px 18px; font-size:16px; border:2px solid #d2d2d7; border-radius:14px; background:white; color:#1d1d1f; font-family:'SF Pro Text'; outline:none; transition: border-color .2s, box-shadow .2s; }
#movieInput:focus { border-color:#0071e3; box-shadow:0 0 0 3px rgba(0,113,227,0.25); }
.dark-theme #movieInput { background:#1c1c1e; border-color:#3a3a3c; color:#f5f5f5; }

.filters-panel { background:white; border-radius:18px; padding:42px; margin-top:24px; box-shadow:0 4px 20px rgba(0,0,0,0.06); border:1px solid #d2d2d7; }
.dark-theme .filters-panel { background:#1c1c1e; box-shadow:0 4px 20px rgba(0,0,0,0.2); border-color:#3a3a3c; }

.filter-section label { display:block; margin-bottom:12px; font-weight:700; color:#1d1d1f; font-family:'SF Pro Display'; }
.dark-theme .filter-section label { color:#f5f5f5; }

.pill-button { padding:10px 16px; border-radius:20px; background:white; border:1px solid #d8d8dd; color:#1d1d1f; font-size:14px; cursor:pointer; font-family:'SF Pro Text'; font-weight:600; }
.dark-theme .pill-button { background:#1c1c1e; border-color:#3a3a3c; color:#f5f5f5; }
.pill-button:hover, .pill-button.active { background:#0071e3; color:white; border-color:#0071e3; transform:scale(1.03); }

.favorites-modal { position:fixed; bottom:0; left:0; right:0; background:white; border-top:1px solid #d2d2d7; padding:24px; box-shadow:0 -4px 20px rgba(0,0,0,0.1); transform:translateY(100%); transition:transform .3s ease; z-index:90; }
.dark-theme .favorites-modal { background:#1c1c1e; border-top-color:#3a3a3c; box-shadow:0 -4px 20px rgba(0,0,0,0.3); }
.favorites-modal.open { transform:translateY(0); }

.movie { background:white; border-radius:16px; padding:20px; margin:16px 0; display:flex; gap:20px; align-items:flex-start; border:1px solid #d2d2d7; }
.dark-theme .movie { background:#1c1c1e; border-color:#3a3a3c; }
.poster { width:96px; height:auto; border-radius:12px; flex-shrink:0; box-shadow:0 4px 12px rgba(0,0,0,0.1); }
.movie-info h3, .movie-info h4 { margin:0 0 8px; font-weight:600; font-size:20px; color:#1d1d1f; }
.dark-theme .movie-info h3, .dark-theme .movie-info h4 { color:#f5f5f5; }
.movie p { margin:6px 0; color:#86868b; font-size:16px; line-height:1.4; }
.dark-theme .movie p { color:#aeaeb2; }

.like-btn { background:none; border:none; font-size:18px; cursor:pointer; margin-top:8px; color:#86868b; transition:transform .2s; }
.like-btn:hover { transform:scale(1.1); }
.like-btn.liked { color:#ff3b30; }

.loading { display:flex; align-items:center; justify-content:center; gap:8px; padding:16px; color:#86868b; }
.dot { width:6px; height:6px; background:#86868b; border-radius:50%; animation:bounce 1.4s infinite both; }
.dot:nth-child(2) { animation-delay:0.2s; } .dot:nth-child(3) { animation-delay:0.4s; }
@keyframes bounce { 0%,80%,100% { transform:scale(1); } 40% { transform:scale(1.2); } }
  </style>
</head>
<body>
  <header class="fixed-header">
    <div class="logo">üé¨ MovieChain</div>
    <div style="display:flex;align-items:center;gap:16px;">
      <button id="favoritesBtn" class="header-button" title="–ò–∑–±—Ä–∞–Ω–Ω–æ–µ">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
          class="favorites-icon" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"></path>
        </svg>
        <span>–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</span>
      </button>
      <div class="theme-toggle-apple" id="themeToggle" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">
        <div class="knob-apple"><div class="icon-center" id="toggleIcon">‚òÄÔ∏è</div></div>
      </div>
    </div>
  </header>

  <main class="main-content">
    <div class="search-card">
      <div class="intro-text-container">
        <p class="intro-text">–û–ø–∏—à–∏—Ç–µ —Ñ–∏–ª—å–º, —ç–º–æ—Ü–∏–∏ –∏–ª–∏ —É–∫–∞–∂–∏—Ç–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏ ‚Äî –ø–æ–ª—É—á–∏—Ç–µ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</p>
      </div>

      <div class="input-group">
        <button id="settingsBtn" class="action-button"><span>–ö—Ä–∏—Ç–µ—Ä–∏–∏</span></button>
        <input type="text" id="movieInput" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: ¬´–ò–Ω—Ç–µ—Ä—Å—Ç–µ–ª–ª–∞—Ä¬ª –∏–ª–∏ ¬´–§–∏–ª—å–º –ø—Ä–æ –Ω–∞–¥–µ–∂–¥—É –≤ –∫–æ—Å–º–æ—Å–µ¬ª" />
        <button id="searchBtn" class="action-button"><span>–ü–æ–∏—Å–∫</span></button>
      </div>

      <div id="filtersPanel" class="filters-panel" style="display:none;">
        <!-- –ü–æ–ª—è —Ñ–∏–ª—å—Ç—Ä–æ–≤ (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) -->
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
          <h3>–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø–æ–∏—Å–∫–∞</h3>
          <button id="resetFilters" class="reset-filters">–°–±—Ä–æ—Å–∏—Ç—å –≤—Å—ë</button>
        </div>

        <div class="filter-section">
          <label>–ñ–∞–Ω—Ä—ã</label>
          <div class="flex-wrap">
            <button class="pill-button" data-id="28">–ë–æ–µ–≤–∏–∫</button>
            <button class="pill-button" data-id="12">–ü—Ä–∏–∫–ª—é—á–µ–Ω–∏—è</button>
            <button class="pill-button" data-id="16">–ú—É–ª—å—Ç—Ñ–∏–ª—å–º</button>
            <button class="pill-button" data-id="35">–ö–æ–º–µ–¥–∏—è</button>
            <button class="pill-button" data-id="80">–ö—Ä–∏–º–∏–Ω–∞–ª</button>
            <button class="pill-button" data-id="99">–î–æ–∫—É–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π</button>
            <button class="pill-button" data-id="18">–î—Ä–∞–º–∞</button>
            <button class="pill-button" data-id="10751">–°–µ–º–µ–π–Ω—ã–π</button>
            <button class="pill-button" data-id="14">–§—ç–Ω—Ç–µ–∑–∏</button>
            <button class="pill-button" data-id="36">–ò—Å—Ç–æ—Ä–∏—è</button>
            <button class="pill-button" data-id="27">–£–∂–∞—Å—ã</button>
            <button class="pill-button" data-id="10402">–ú—É–∑—ã–∫–∞</button>
            <button class="pill-button" data-id="9648">–î–µ—Ç–µ–∫—Ç–∏–≤</button>
            <button class="pill-button" data-id="10749">–ú–µ–ª–æ–¥—Ä–∞–º–∞</button>
            <button class="pill-button" data-id="878">–§–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞</button>
            <button class="pill-button" data-id="53">–¢—Ä–∏–ª–ª–µ—Ä</button>
            <button class="pill-button" data-id="10752">–í–æ–µ–Ω–Ω—ã–π</button>
            <button class="pill-button" data-id="37">–í–µ—Å—Ç–µ—Ä–Ω</button>
          </div>
        </div>

        <div class="filter-section">
          <label>–ì–æ–¥ –æ—Ç / –¥–æ</label>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
            <input type="number" id="yearFrom" placeholder="1990" min="1900" max="2025">
            <input type="number" id="yearTo" placeholder="2024" min="1900" max="2025">
          </div>
        </div>

        <div class="filter-section">
          <div class="rating-section">
            <div class="rating-label">–†–µ–π—Ç–∏–Ω–≥: <span id="ratingDisplay">0 ‚Äì 10</span></div>
            <div class="rating-sliders">
              <input type="range" id="ratingFrom" min="0" max="10" step="0.5" value="0">
              <input type="range" id="ratingTo" min="0" max="10" step="0.5" value="10">
            </div>
          </div>
        </div>

        <div class="filter-section">
          <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π: <span id="countValue">5</span></label>
          <input type="range" id="movieCount" min="3" max="15" value="5">
        </div>

        <div class="filter-section">
          <label>–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ</label>
          <div class="flex-wrap">
            <button class="pill-button mood-btn" data-value="–≤–µ—Å–µ–ª—ã–π">–í–µ—Å–µ–ª—ã–π</button>
            <button class="pill-button mood-btn" data-value="–≥—Ä—É—Å—Ç–Ω—ã–π">–ì—Ä—É—Å—Ç–Ω—ã–π</button>
            <button class="pill-button mood-btn" data-value="–Ω–∞–ø—Ä—è–∂–µ–Ω–Ω—ã–π">–ù–∞–ø—Ä—è–∂–µ–Ω–Ω—ã–π</button>
            <button class="pill-button mood-btn" data-value="–≤–¥–æ—Ö–Ω–æ–≤–ª—è—é—â–∏–π">–í–¥–æ—Ö–Ω–æ–≤–ª—è—é—â–∏–π</button>
            <button class="pill-button mood-btn" data-value="–ø—É–≥–∞—é—â–∏–π">–ü—É–≥–∞—é—â–∏–π</button>
            <button class="pill-button mood-btn" data-value="—Ä–æ–º–∞–Ω—Ç–∏—á–Ω—ã–π">–†–æ–º–∞–Ω—Ç–∏—á–Ω—ã–π</button>
          </div>
        </div>

        <div class="filter-section">
          <label>–¢–µ–º–ø</label>
          <div style="display:flex;gap:12px;">
            <button class="pill-button pace-btn" data-value="–º–µ–¥–ª–µ–Ω–Ω—ã–π">–ú–µ–¥–ª–µ–Ω–Ω—ã–π</button>
            <button class="pill-button pace-btn" data-value="—Å—Ä–µ–¥–Ω–∏–π">–°—Ä–µ–¥–Ω–∏–π</button>
            <button class="pill-button pace-btn" data-value="–¥–∏–Ω–∞–º–∏—á–Ω—ã–π">–î–∏–Ω–∞–º–∏—á–Ω—ã–π</button>
          </div>
        </div>

        <div class="filter-section">
          <label>–ü—Ä–æ—Å–º–æ—Ç—Ä</label>
          <div class="flex-wrap">
            <button class="pill-button watch-btn" data-value="–æ–¥–∏–Ω">–û–¥–∏–Ω</button>
            <button class="pill-button watch-btn" data-value="—Å —Å–µ–º—å–µ–π">–° —Å–µ–º—å–µ–π</button>
            <button class="pill-button watch-btn" data-value="—Å –¥—Ä—É–∑—å—è–º–∏">–° –¥—Ä—É–∑—å—è–º–∏</button>
            <button class="pill-button watch-btn" data-value="—Ä–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –≤–µ—á–µ—Ä">–†–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –≤–µ—á–µ—Ä</button>
          </div>
        </div>

        <div class="filter-section">
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
            <div>
              <label>–†–µ–∂–∏—Å—Å—ë—Ä</label>
              <input type="text" id="director" placeholder="–ö—Ä–∏—Å—Ç–æ—Ñ–µ—Ä –ù–æ–ª–∞–Ω">
            </div>
            <div>
              <label>–ê–∫—Ç—ë—Ä—ã (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)</label>
              <input type="text" id="actors" placeholder="–õ–µ–æ–Ω–∞—Ä–¥–æ –î–∏–ö–∞–ø—Ä–∏–æ">
            </div>
          </div>
        </div>
      </div>

      <div id="result"></div>
      <div id="similar"></div>
    </div>
  </main>

  <div id="favoritesModal" class="favorites-modal">
    <h3>–ò–∑–±—Ä–∞–Ω–Ω—ã–µ —Ñ–∏–ª—å–º—ã</h3>
    <div id="favoritesList" class="favorites-list"></div>
    <button id="closeFavorites" class="close-favorites">–ó–∞–∫—Ä—ã—Ç—å</button>
  </div>

  <script>
/*
  Demo-safe index.html
  - –£–±—Ä–∞–Ω—ã –ø—Ä—è–º—ã–µ –≤—ã–∑–æ–≤—ã –∫ TMDb (–Ω–µ—Ç API-–∫–ª—é—á–∞).
  - –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ –ª–æ–∫–∞–ª—å–Ω—ã–π backend:
    POST http://localhost:5000/recommend
  - –ë—ç–∫–µ–Ω–¥ –≤ –¥–µ–º–æ—Ä–µ–∂–∏–º–µ –¥–æ–ª–∂–µ–Ω –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –æ–±—ä–µ–∫—Ç—ã —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π:
    { title, year, poster_url (optional), genres (optional array), reason (optional) }
  - –ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –≤–µ—Ä–Ω—É—Ç—å TMDb-–æ–±–æ–≥–∞—â–µ–Ω–∏–µ ‚Äî –¥–µ–ª–∞–π—Ç–µ —ç—Ç–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –∏ –Ω–µ —Ö—Ä–∞–Ω–∏—Ç–µ –∫–ª—é—á–∏ –≤ –∫–ª–∏–µ–Ω—Ç–µ.
*/

document.addEventListener('DOMContentLoaded', () => {
  const body = document.body;
  const toggle = document.getElementById('themeToggle');
  const knob = document.querySelector('.knob-apple');
  const icon = document.getElementById('toggleIcon');
  const filtersPanel = document.getElementById('filtersPanel');
  const favoritesModal = document.getElementById('favoritesModal');
  const favoritesList = document.getElementById('favoritesList');
  const favoritesBtn = document.getElementById('favoritesBtn');
  const closeFavorites = document.getElementById('closeFavorites');
  const resetFilters = document.getElementById('resetFilters');
  const searchBtn = document.getElementById('searchBtn');
  const movieInput = document.getElementById('movieInput');

  // Theme init
  const savedTheme = localStorage.getItem('theme') || 'light';
  if (savedTheme === 'dark') {
    body.classList.add('dark-theme');
    icon.textContent = 'üåô';
    knob.style.transform = `translateX(${toggle.offsetWidth - knob.offsetWidth - 8}px)`;
  } else {
    icon.textContent = '‚òÄÔ∏è';
    knob.style.transform = 'translateX(0)';
  }

  toggle.addEventListener('click', () => {
    const willBeDark = !body.classList.contains('dark-theme');
    body.classList.toggle('dark-theme', willBeDark);
    localStorage.setItem('theme', willBeDark ? 'dark' : 'light');
    icon.textContent = willBeDark ? 'üåô' : '‚òÄÔ∏è';
    knob.style.transform = willBeDark ? `translateX(${toggle.offsetWidth - knob.offsetWidth - 8}px)` : 'translateX(0)';
  });

  // Criteria panel
  document.getElementById('settingsBtn').addEventListener('click', () => {
    filtersPanel.style.display = filtersPanel.style.display === 'none' ? 'block' : 'none';
  });

  resetFilters.addEventListener('click', () => {
    document.querySelectorAll('.pill-button').forEach(btn => btn.classList.remove('active'));
    document.getElementById('yearFrom').value = '';
    document.getElementById('yearTo').value = '';
    document.getElementById('ratingFrom').value = 0;
    document.getElementById('ratingTo').value = 10;
    document.getElementById('movieCount').value = 5;
    document.getElementById('director').value = '';
    document.getElementById('actors').value = '';
    document.getElementById('ratingDisplay').textContent = '0 ‚Äì 10';
    document.getElementById('countValue').textContent = '5';
    updateSearchButton();
  });

  const ratingFromSlider = document.getElementById('ratingFrom');
  const ratingToSlider = document.getElementById('ratingTo');
  const ratingDisplay = document.getElementById('ratingDisplay');
  ratingFromSlider.addEventListener('input', () => { updateRatingDisplay(); updateSearchButton(); });
  ratingToSlider.addEventListener('input', () => { updateRatingDisplay(); updateSearchButton(); });
  function updateRatingDisplay() { ratingDisplay.textContent = `${parseFloat(ratingFromSlider.value)} ‚Äì ${parseFloat(ratingToSlider.value)}`; }

  const countSlider = document.getElementById('movieCount');
  countSlider.addEventListener('input', () => {
    document.getElementById('countValue').textContent = countSlider.value;
    updateSearchButton();
  });

  document.querySelectorAll('.pill-button').forEach(btn => btn.addEventListener('click', () => { btn.classList.toggle('active'); updateSearchButton(); }));
  ['yearFrom','yearTo','director','actors'].forEach(id => document.getElementById(id).addEventListener('input', updateSearchButton));

  // Favorites
  function toggleFavorites() {
    const isOpen = favoritesModal.classList.contains('open');
    if (isOpen) {
      favoritesModal.classList.remove('open');
      favoritesBtn.classList.remove('active');
    } else {
      renderFavorites();
      favoritesModal.classList.add('open');
      favoritesBtn.classList.add('active');
    }
  }
  favoritesBtn.addEventListener('click', toggleFavorites);
  closeFavorites.addEventListener('click', toggleFavorites);

  function renderFavorites() {
    const liked = JSON.parse(localStorage.getItem('likedMovies') || '[]');
    favoritesList.innerHTML = liked.length ? liked.map(m => `<div class="favorite-item"><strong>${m.Title}</strong> (${m.Year})</div>`).join('') : '<p style="color:#86868b;">–ù–µ—Ç —Ñ–∏–ª—å–º–æ–≤ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–º</p>';
  }

  function getSelectedGenres() {
    return Array.from(document.querySelectorAll('.pill-button[data-id].active')).map(btn => parseInt(btn.dataset.id));
  }

  function canSearch() {
    const query = movieInput.value.trim();
    if (query) return true;
    const hasGenre = document.querySelectorAll('.pill-button[data-id].active').length > 0;
    const ratingFrom = parseFloat(ratingFromSlider.value);
    const ratingTo = parseFloat(ratingToSlider.value);
    const hasRating = !(ratingFrom === 0 && ratingTo === 10);
    const hasYear = !!document.getElementById('yearFrom').value.trim() || !!document.getElementById('yearTo').value.trim();
    const hasDirector = !!document.getElementById('director').value.trim();
    const hasActors = !!document.getElementById('actors').value.trim();
    const hasMood = document.querySelectorAll('.mood-btn.active').length > 0;
    const hasPace = document.querySelectorAll('.pace-btn.active').length > 0;
    const hasWatch = document.querySelectorAll('.watch-btn.active').length > 0;
    const hasCount = parseInt(countSlider.value) !== 5;
    return hasGenre || hasRating || hasYear || hasDirector || hasActors || hasMood || hasPace || hasWatch || hasCount;
  }

  function updateSearchButton() { searchBtn.disabled = !canSearch(); }
  movieInput.addEventListener('input', updateSearchButton);
  updateSearchButton();

  // Demo-safe search: –æ–±—Ä–∞—â–∞–µ–º—Å—è —Ç–æ–ª—å–∫–æ –∫ –ª–æ–∫–∞–ª—å–Ω–æ–º—É backend (–±–µ–∑ TMDb)
  async function findSimilar() {
    const query = movieInput.value.trim();
    const resultDiv = document.getElementById("result");
    const similarDiv = document.getElementById("similar");
    resultDiv.innerHTML = "";
    similarDiv.innerHTML = "<p style='text-align:center;color:#86868b;padding:16px;'>–ò—â–µ–º...</p>";
    try {
      // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –ø—Ä–æ—Å—Ç—É—é –∫–∞—Ä—Ç–æ—á–∫—É –≤–≤–µ–¥—ë–Ω–Ω–æ–≥–æ –Ω–∞–∑–≤–∞–Ω–∏—è (–±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤)
      if (query) {
        resultDiv.innerHTML = `
          <div class="movie">
            <div style="width:96px;height:144px;background:#f0f0f0;border-radius:12px;display:flex;align-items:center;justify-content:center;color:#86868b;">${escapeHtml(shorten(query,18))}</div>
            <div class="movie-info">
              <h3>${escapeHtml(shorten(query,60))}</h3>
              <p style="color:#86868b;margin-top:8px;">–î–∞–Ω–Ω—ã–µ –æ —Ñ–∏–ª—å–º–µ –¥–æ—Å—Ç—É–ø–Ω—ã –≤ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–∏ —Å–µ—Ä–≤–∏—Å–∞.</p>
            </div>
          </div>
        `;
      }

      // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –∫—Ä–∏—Ç–µ—Ä–∏–∏ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—ã–π –±—ç–∫–µ–Ω–¥
      const criteria = {
        mood: query,
        genres: getSelectedGenres(),
        minRating: parseFloat(ratingFromSlider.value),
        maxRating: parseFloat(ratingToSlider.value),
        count: parseInt(countSlider.value) || 5,
        yearFrom: document.getElementById('yearFrom').value.trim(),
        yearTo: document.getElementById('yearTo').value.trim(),
        director: document.getElementById('director').value.trim(),
        actors: document.getElementById('actors').value.trim(),
        likedMovies: JSON.parse(localStorage.getItem('likedMovies') || '[]'),
        requireRomance: Array.from(document.querySelectorAll('.mood-btn.active')).some(btn => btn.dataset.value === '—Ä–æ–º–∞–Ω—Ç–∏—á–Ω—ã–π') ||
                       Array.from(document.querySelectorAll('.watch-btn.active')).some(btn => btn.dataset.value === '—Ä–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –≤–µ—á–µ—Ä')
      };

      similarDiv.innerHTML = "<p style='text-align:center;color:#86868b;padding:16px;'>–ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏... ü§ñ</p>";

      // –í–ù–ò–ú–ê–ù–ò–ï: –∞–¥—Ä–µ—Å –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –¥–µ–º–æ-–±—ç–∫–µ–Ω–¥–∞. –ï—Å–ª–∏ –æ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –¥—Ä—É–≥–æ–º —Ö–æ—Å—Ç–µ/–ø–æ—Ä—Ç—É, –∏–∑–º–µ–Ω–∏—Ç–µ URL.
      const aiRes = await fetch("http://localhost:5000/recommend", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(criteria)
      });

      const aiData = await aiRes.json();
      similarDiv.innerHTML = "";

      if (aiData.recommendations?.length) {
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ, –≤–æ–∑–≤—Ä–∞—â—ë–Ω–Ω—ã–µ –±—ç–∫–µ–Ω–¥–æ–º. –ï—Å–ª–∏ –Ω–µ—Ç poster_url ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä.
        const enriched = aiData.recommendations.map(r => ({
          Title: r.title || r.Title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è',
          Year: r.year || r.Year || '????',
          Genre: (r.genres && Array.isArray(r.genres) ? r.genres.join(', ') : (r.genre || '‚Äî')),
          imdbRating: r.vote_average ? Number(r.vote_average).toFixed(1) : (r.vote ? String(r.vote) : '‚Äî'),
          Plot: r.reason || '–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –ø–æ–¥–æ–±—Ä–∞–Ω–∞ —Å–∏—Å—Ç–µ–º–æ–π.',
          Poster: r.poster_url || 'https://via.placeholder.com/96x144?text=No+Poster'
        }));
        renderSimilarMovies(enriched, similarDiv);
      } else {
        similarDiv.innerHTML = "<p style='text-align:center;color:#86868b;padding:20px;'>–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞.</p>";
      }
    } catch (err) {
      console.error("–û—à–∏–±–∫–∞ –≤ findSimilar:", err);
      resultDiv.innerHTML = `<p style="color:red; text-align:center; padding:16px;">‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ.</p>`;
      similarDiv.innerHTML = "";
    }
  }

  function shorten(text, max) {
    if (!text) return '';
    return text.length > max ? text.slice(0, max-1) + '‚Ä¶' : text;
  }

  function escapeHtml(s) { return String(s).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

  function renderSimilarMovies(movies, container) {
    container.innerHTML = "<h3 style='color:#0071e3;margin:32px 0 16px;'>‚ú® –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:</h3>";
    const liked = JSON.parse(localStorage.getItem('likedMovies') || '[]');
    movies.forEach(m => {
      const isLiked = liked.some(l => l.Title === m.Title && l.Year === m.Year);
      container.innerHTML += `
        <div class="movie">
          <img class="poster" src="${m.Poster}" alt="poster" />
          <div class="movie-info">
            <h4>${escapeHtml(m.Title)} (${escapeHtml(m.Year)})</h4>
            <p><strong>–ñ–∞–Ω—Ä:</strong> ${escapeHtml(m.Genre || '‚Äî')}</p>
            <p><strong>–†–µ–π—Ç–∏–Ω–≥:</strong> ${escapeHtml(m.imdbRating || '‚Äî')}</p>
            <p style="color:#86868b;">${escapeHtml(m.Plot || '')}</p>
            <button class="like-btn ${isLiked ? 'liked' : ''}" data-title="${escapeHtml(m.Title)}" data-year="${escapeHtml(m.Year)}">${isLiked ? '‚ù§Ô∏è' : 'ü§ç'}</button>
          </div>
        </div>
      `;
    });
    document.querySelectorAll('.like-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        const title = e.currentTarget.dataset.title;
        const year = e.currentTarget.dataset.year;
        let liked = JSON.parse(localStorage.getItem('likedMovies') || '[]');
        const exists = liked.some(m => m.Title === title && m.Year === year);
        if (exists) {
          liked = liked.filter(m => !(m.Title === title && m.Year === year));
          e.currentTarget.classList.remove('liked');
          e.currentTarget.textContent = 'ü§ç';
        } else {
          liked.push({ Title: title, Year: year });
          e.currentTarget.classList.add('liked');
          e.currentTarget.textContent = '‚ù§Ô∏è';
        }
        localStorage.setItem('likedMovies', JSON.stringify(liked));
        if (favoritesModal.classList.contains('open')) renderFavorites();
      });
    });
  }

  searchBtn.addEventListener("click", findSimilar);
  movieInput.addEventListener("keypress", (e) => { if (e.key === "Enter" && canSearch()) findSimilar(); });
});
  </script>
</body>
</html>